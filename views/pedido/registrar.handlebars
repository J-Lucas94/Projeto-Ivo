<hr>
<div class="folder">
    <ul class="abas">
        <li class="aba" id="aba-1">
            <a class="nav-link link-dark" onclick="mostrar()">Pedido</a>

        <li class="aba" id="aba-2">
            <a class="nav-link link-dark" onclick="mostrar1()">Itens</a>

        <li class="aba" id="aba-3">
            <button id="form1" type="button" class="btn btn-success me-2 ms-2">Registrar</button>

    </ul>
</div>

<script>
    function mostrar() {
        const mudar = document.querySelector(".header")
        const mudar1 = document.querySelector('.tabelaScroll')
        mudar.style.display = "block"
        mudar1.style.display = "none"
    }

    function mostrar1() {
        const mudar = document.querySelector(".header")
        const mudar1 = document.querySelector('.tabelaScroll')
        mudar1.style.display = "block"
        mudar.style.display = "none"

    }

    function esconder() {
        const mudar = document.querySelector(".header")
        mudar.style.display = "none"
        const mudar1 = document.querySelector('.tabelaScroll')
        mudar1.style.display = "none"
    }

</script>


<div class="container-fluid">

    <button id="form1" type="button" class="btn-success formR col-2">Registrar</button>
    <hr>
    <form>
        <div class="header">
            <div class="row">
                <div class="form-group col-sm-2">
                    <label>ID Pedido</label>
                    <input class="form-control" type="text" name="idPedido" id="idPedido" placeholder="ID Pedido"
                        value="{{pedido.id}}" required>
                </div>

                <div class="form-group col-sm-2">
                    <label>Vendedor</label>
                    <input class="form-control" type="text" name="vendedor" id="vendedor" placeholder="Vendedor..."
                        value="{{pedido.vendedor}}" required>
                    <small id="erro-vendedor" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Cód. Cliente</label>
                    <input class="form-control" type="text" name="cod_cliente" id="cod_cliente"
                        placeholder="Código do cliente..." value="{{pedido.cod_cliente}}" required>
                    <small id="erro-cod_cliente" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-1">
                    <label>Loja</label>
                    <input class="form-control" type="text" name="loja_numero" id="loja_numero" placeholder="Loja..."
                        value="{{pedido.loja_numero}}" required>
                    <small id="erro-loja_numero" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Data</label>
                    <input class="form-control" type="date" name="data" id="data" placeholder="Digite a Data..."
                        value="{{pedido.data}}" required>
                    <small id="erro-data" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-3">
                    <label>Nome/ Razão Social: </label>
                    <input class="form-control" type="text" name="razao_social" id="razao_social"
                        placeholder="Nome ou Razão Social..." value="{{pedido.razao_social}}" required>
                    <small id="erro-razao_social" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-1">
                    <label>CEP</label>
                    <input class="form-control" type="text" name="cep" id="cep"
                        placeholder="Digite o CEP sem o traço..." value="{{pedido.cep}}" required>
                    <small id="erro-cep" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-3">
                    <label>Endereço</label>
                    <input class="form-control" type="text" name="endereco" id="endereco"
                        placeholder="Digite o seu endereço..." value="{{pedido.endereco}}" required>
                    <small id="erro-endereco" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-3">
                    <label>Bairro</label>
                    <input class="form-control" type="text" name="bairro" id="bairro"
                        placeholder="Digite o seu bairro..." value="{{pedido.bairro}}" required>
                    <small id="erro-bairro" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Municipio</label>
                    <input class="form-control" type="text" name="municipio" id="municipio"
                        placeholder="Digite o seu municipio..." value="{{pedido.municipio}}" required>
                    <small id="erro-municipio" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-1">
                    <label>UF</label>
                    <input class="form-control" type="text" name="uf" id="uf" placeholder="Estado..."
                        value="{{pedido.uf}}" required>
                    <small id="erro-uf" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>E-mail</label>
                    <input class="form-control" type="email" name="email" id="email" placeholder="Digite um E-mail..."
                        value="{{pedido.email}}" required>
                    <small id="erro-email" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Fone/Fax</label>
                    <input class="form-control" type="tel" name="fone" id="fone" placeholder="Telefone ou Fax..."
                        value="{{pedido.fone}}" required>
                    <small id="erro-fone" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Contato</label>
                    <input class="form-control" type="text" name="contato" id="contato" placeholder="Contato..."
                        value="{{pedido.contato}}" required>
                    <small id="erro-contato" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>CNPJ/CPF</label>
                    <input class="form-control" type="text" name="cpf" id="cpf" placeholder="CPF OU CNPJ..."
                        value="{{pedido.cpf}}" required>
                    <small id="erro-cpf" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Inscrição Estadual</label>
                    <input class="form-control" type="text" name="inscricao" id="inscricao"
                        placeholder="Inscrição Estadual..." value="{{pedido.inscricao}}" required>
                    <small id="erro-inscricao" class="vermelho"></small>
                </div>

                <div class="form-group col-sm-2">
                    <label>Condição do Pagamento</label>
                    <input class="form-control" type="text" name="cond_pagamento" id="cond_pagamento"
                        placeholder="Condição do Pagamento..." value="{{pedido.cond_pagamento}}" required>
                    <small id="erro-cond_pagamento" class="vermelho"></small>
                </div>

                <div class="form-group mb-5 col-sm-2">
                    <label>Transportadora</label>
                    <input class="form-control" type="text" name="transportadora" id="transportadora"
                        placeholder="Transportadora..." value="{{pedido.transportadora}}" required>
                    <small id="erro-transportadora" class="vermelho"></small>
                </div>

            </div>
        </div>
    </form>
</div>


<div class="table1 col-12 mt-4">
    <div class="tabelaScroll">
        <button class="btn btn-primary col-2 ms-3 mt-3" onclick="javascript:preencher(event)"
            type="button">Adicionar</button>
        <button class="btn btn-primary col-2 ms-3 mt-3" onclick="javascript:adicionarCampo()" type="button">+</button>
        <table id="tabela" class="tabela table table-sm">
            <thead>
                <tr>
                    <th id="erro-item">Item</th>
                    <th id="erro-produto">Produto</th>
                    <th id="erro-descricao">Descrição</th>
                    <th id="erro-quantidade">Quantidade</th>
                    <th id="erro-gbu">GBU</th>
                    <th id="erro-valor_unit">ValorUnit</th>
                    <th id="erro-desc1">Desc1 </th>
                    <th id="erro-valor_unit1">ValorUnit1</th>
                    <th id="erro-desc2">Desc2 </th>
                    <th id="erro-valor_unit2">ValorUnit2</th>
                    <th id="erro-descFinal">DescFinal </th>
                    <th id="erro-valor_unit3">ValorUnit3</th>
                    <th id="erro-total">Total </th>
                    <th id="erro-acoes">Ações </th>
                </tr>
            </thead>

            <tbody class="novalinha" id="itens">

                {{#if itens}}

                {{#each itens}}
                <tr>

                    <div>
                        <td><input id="item" class="item" type="text" value="{{this.item}}" required></td>
                    </div>
                    <td><input id="produto" class="produto" type="text" list="produtos" type="text"
                            value="{{this.produto}}" readonly required></td>

                    <td><input id="descricao" class="descricao" type="text" value="{{this.descricao}}" readonly>
                    </td>
                    <td><input id="quantidade" class="quantidade" type="text" value="{{this.quantidade}}" readonly
                            required>
                    </td>

                    <td><input id="gbu" class="gbu" type="text" value="{{this.gbu}}" readonly required>
                    </td>

                    <td><input id="valor_unit" class="valor_unit" onchange="valor1()" type="text"
                            value="{{this.valor_unit}}" readonly required></td>

                    <td><input id="desc1" class="desc1" onchange="valor1()" type="number" min="0" max="99" step=".01"
                            value="{{this.desc1}}">
                    </td>
                    <td><input id="valor_unit1" class="valor_unit1" onchange="valor1()" type="text"
                            value="{{this.valor_unit1}}" readonly required></td>

                    <td><input id="desc2" class="desc2" onchange="valor1()" type="number" min="0" max="99" step=".01"
                            value="{{this.desc2}}">
                    </td>
                    <td><input id="valor_unit2" class="valor_unit2" onchange="valor1()" type="text"
                            value="{{this.valor_unit2}}" readonly required></td>

                    <td><input id="desc_final" class="desc_final" onchange="valor1()" min="0" max="99" step=".01"
                            type="number" value="{{this.desc_final}}">

                    </td>
                    <td><input id="valor_unit3" class="valor_unit3" onchange="valor1()"
                            style="text-align: right; width:100px;" type="text" value="{{this.valor_unit3}}" readonly
                            required></td>

                    <td><input id="total" class="total" type="text" value="{{this.total}}" readonly required>

                    </td>
                    <td class="acoes">
                        <span class="btn-danger excluirC">
                            Excluir
                        </span>
                    </td>

                </tr>

                {{/each}}

                {{else}}

                <tr>

                </tr>

                {{/if}}

            </tbody>

        </table>
    </div>

</div>

<datalist id="produtos">
    {{#each produto}}
    <option class="listaP" value="{{this.cod_produto}}">{{this.categoria}} - {{this.descricao}}</option>
    {{/each}}
</datalist>
<div class="footer bg-light">
    <h6 class="m-auto valorT"></h6>
</div>
<script>

    async function preencher(event) {


        var text = await navigator.clipboard.readText()
        var produto
        text.split('\n').map(async (linha) => {
            produto = linha.split('\r')[0]


            try {
                const result = await fetch('/pedido/produtos/' + produto)
                var response = await result.json()

                if (result.status == 400) {
                    swal("Error", "Produto invalido: " + produto, "error")

                } else {
                    var trItens = document.querySelectorAll(".tr-item")


                    if (trItens.length == 0) {
                        controleCampo = 1
                    } else {

                        var controleCampo = await parseInt(document.querySelectorAll(".tr-item")[document.querySelectorAll(".tr-item").length - 1].getAttribute('data-item')) + 1

                    }

                    var tr = document.createElement('tr')
                    tr.setAttribute('data-item', `${controleCampo}`)
                    tr.setAttribute('class', 'tr-item')
                    var td = document.createElement('td')
                    var input = document.createElement('input')
                    tr.appendChild(td)
                    td.appendChild(input)
                    input.value = produto
                    input.setAttribute("name", "item")
                    input.setAttribute("class", "item")
                    input.setAttribute("id", "item")
                    input.setAttribute("list", "item")
                    input.setAttribute("type", "text")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "produto")
                    input.setAttribute("class", "produto")
                    input.setAttribute("id", "produto")
                    input.setAttribute("onchange", "produtoVal(this.value)")
                    input.setAttribute("list", "produtos")
                    input.setAttribute("type", "text")
                    input.setAttribute("readonly", "readonly")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "descricao")
                    input.setAttribute("class", "descricao")
                    input.setAttribute("id", "descricao")
                    input.setAttribute("type", "text")
                    input.setAttribute("readonly", "readonly")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "quantidade")
                    input.setAttribute("class", "quantidade")
                    input.setAttribute("id", "quantidade")
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("type", "number")
                    input.setAttribute("value", 1)
                    input.setAttribute("min", "1")
                    input.setAttribute("max", "10000")
                    input.setAttribute("step", ".01")
                    input.setAttribute("oninput", "validity.valid||(value='')")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "gbu")
                    input.setAttribute("class", "gbu")
                    input.setAttribute("id", "gbu")
                    input.setAttribute("type", "gbu")
                    input.setAttribute("readonly", "readonly")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "valor_unit")
                    input.setAttribute("class", "valor_unit")
                    input.setAttribute("id", "valor_unit")
                    input.setAttribute("type", "text")
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("readonly", "readonly")


                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "desc1")
                    input.setAttribute("class", "desc1")
                    input.setAttribute("id", "desc1")
                    input.setAttribute("type", "number")
                    input.setAttribute("value", 0.00)
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("min", "0")
                    input.setAttribute("max", "10000")
                    input.setAttribute("step", ".01")
                    input.setAttribute("oninput", "validity.valid||(value='')")


                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "valor_unit1")
                    input.setAttribute("class", "valor_unit1")
                    input.setAttribute("id", "valor_unit1")
                    input.setAttribute("type", "text")
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("readonly", "readonly")


                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "desc2")
                    input.setAttribute("class", "desc2")
                    input.setAttribute("id", "desc2")
                    input.setAttribute("type", "number")
                    input.setAttribute("value", 0.00)
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("min", "0")
                    input.setAttribute("max", "10000")
                    input.setAttribute("oninput", "validity.valid||(value='')")


                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "valor_unit2")
                    input.setAttribute("class", "valor_unit2")
                    input.setAttribute("id", "valor_unit2")
                    input.setAttribute("type", "text")
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("readonly", "readonly")


                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "desc_final")
                    input.setAttribute("class", "desc_final")
                    input.setAttribute("id", "desc_final")
                    input.setAttribute("type", "number")
                    input.setAttribute("value", 0.00)
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("min", "0")
                    input.setAttribute("max", "10000")
                    input.setAttribute("oninput", "validity.valid||(value='')")


                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "valor_unit3")
                    input.setAttribute("class", "valor_unit3")
                    input.setAttribute("id", "valor_unit3")
                    input.setAttribute("type", "text")
                    input.setAttribute("onchange", "valor1()")
                    input.setAttribute("readonly", "readonly")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var input = document.createElement('input')
                    td.appendChild(input)
                    input.setAttribute("name", "total")
                    input.setAttribute("class", "total")
                    input.setAttribute("id", "total")
                    input.setAttribute("type", "text")
                    input.setAttribute("readonly", "readonly")

                    var td = document.createElement('td')
                    tr.appendChild(td)
                    var span = document.createElement('span')
                    td.appendChild(span)
                    span.innerHTML = "Excluir"

                    span.setAttribute("class", "btn-danger excluirC")


                    document.getElementById('itens').appendChild(tr)

                    var tabela = document.querySelector('#tabela');

                    var item = document.querySelectorAll(".tr-item")[controleCampo - 1]

                    var produto = item.querySelector(".produto").value = response.descricao
                    var descricao = item.querySelector(".descricao").value = response.categoria
                    var gbu = item.querySelector(".gbu").value = response.gbu
                    var valor_unit = item.querySelector(".valor_unit").value = response.precos
                    var valor_unit1 = item.querySelector(".valor_unit1").value = response.precos
                    var valor_unit2 = item.querySelector(".valor_unit2").value = response.precos
                    var valor_unit3 = item.querySelector(".valor_unit3").value = response.precos
                    var valor_unit3 = item.querySelector(".total").value = response.precos

                }
                valor1()
            } catch {
                swal("Error", "Não foi possivel preencher os itens", "error")
            }

        })
    }


    function produtoVal(valor) {

        var lista = document.querySelectorAll('.listaP')

        var lResult = false;

        lista.forEach((item) => {
            if (item.value == valor) {
                lResult = true;
                return
            }
        });

        if (lResult == false) {
            swal("Error !", "Produto não encontrado!", "error");
            document.getElementById('form1').disabled = true;
            document.getElementById('erro-produto').innerHTML = "Produto não encontrado!";
            document.getElementById('erro-produto').style.color = 'red';
            return false;
        } else {
            document.getElementById('erro-produto').innerHTML = "Produto";
            document.getElementById('erro-produto').style.color = 'black';
            document.getElementById('form1').disabled = false;
        }
    }

    tabela.addEventListener("click", ((event) => {
        var elementoClicado = event.target;
        if (elementoClicado.classList.contains("btn-danger")) {
            var celula = elementoClicado.parentNode;
            var linha = celula.parentNode;
            linha.remove();
        }
    }))

    function valor1() {

        var trItens = document.querySelectorAll(".tr-item")
        var totalGeral = 0
        trItens.forEach((trItem) => {

            var quantidade = trItem.querySelector('.quantidade').value
            var valor_unit = trItem.querySelector('.valor_unit').value
            var desc1 = trItem.querySelector('.desc1').value
            var valor_unit1 = trItem.querySelector('.valor_unit1').value
            var desc2 = trItem.querySelector('.desc2').value
            var valor_unit2 = trItem.querySelector('.valor_unit2').value
            var desc_final = trItem.querySelector('.desc_final').value
            var valor_unit3 = trItem.querySelector('.valor_unit3').value
            var total = trItem.querySelector('.total').value

            var ValorUnitP = valor_unit.replace(/,/gi, ".");

            var calculo = parseFloat(desc1) * parseFloat(ValorUnitP) / 100
            var calc = calculo - parseFloat(ValorUnitP)
            var calcP = calc * -1

            if (calc) {
                trItem.querySelector('.valor_unit1').value = calcP.toFixed(2)
            }

            var calc3 = calc * parseFloat(desc2) / 100
            var calc4 = calc3 - calc

            if (calc4) {
                trItem.querySelector('.valor_unit2').value = calc4.toFixed(2)
            }

            var calc6 = calc4 * parseFloat(desc_final) / 100
            var calc7 = calc6 - parseFloat(calc4)
            var calc7P = calc7 * -1



            if (calc4) {
                trItem.querySelector('.valor_unit3').value = calc4.toFixed(2)
            }

            if (calc7) {
                trItem.querySelector('.valor_unit3').value = calc7P.toFixed(2)
                trItem.querySelector('.total').value = calc7P.toFixed(2)
            }

            if (calc) {
                trItem.querySelector('.total').value = calcP.toFixed(2)
            }

            if (calc4) {
                trItem.querySelector('.total').value = calc4.toFixed(2)
            }

            if (calc7P) {
                trItem.querySelector('.total').value = calc7P.toFixed(2)
            }

            var valorT = trItem.querySelector('.total').value
            var valorF = valorT * quantidade

            trItem.querySelector('.total').value = valorF.toFixed(2)

            totalGeral = totalGeral + valorF

        });
        document.querySelector('.valorT').innerHTML = `Total: ${totalGeral.toFixed(2)}`
    }

    var controleCampo = 1
    function adicionarCampo() {
        controleCampo++
        document.querySelector('.novalinha').insertAdjacentHTML('beforeend',
            '<tr data-item="${controleCampo}" class="tr-item"><td><input id="item" class="item"  type="text" value="' + controleCampo + '"></td><td><input id="produto"class="produto" onchange="produtoVal(this.value)" style="text-align: right;" type="text" type="text" list="produtos"></td><td><input id="descricao" class="descricao" style="text-align: right;" type="text"></td><td><input id="quantidade" class="quantidade" style="text-align: right;" type="text"></td><td><input id="gbu" class="gbu" style="text-align: right;" type="text"></td><td><input id="valor_unit" class="valor_unit" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="desc1" class="desc1" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="valor_unit1" class="valor_unit1" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="desc2" class="desc2" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="valor_unit2" class="valor_unit2" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="desc_final" class="desc_final" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="valor_unit3" class="valor_unit3" onchange="valor1()" style="text-align: right;" type="text"></td><td><input id="total" class="total" style="text-align: right;" type="text"></td></td><td class="acoes"><span class="btn-danger excluirC">Excluir</span></td></tr>'
        )
    }


    //Fetch Pedido
    try {
        let form1 = document.querySelector('#form1')
        form1.addEventListener('click', async () => {
            let idPedido = document.querySelector('#idPedido').value
            let vendedor = document.querySelector('#vendedor').value
            let cod_cliente = document.querySelector('#cod_cliente').value
            let loja_numero = document.querySelector('#loja_numero').value
            let data = document.querySelector('#data').value
            let razao_social = document.querySelector('#razao_social').value
            let cep = document.querySelector('#cep').value
            let endereco = document.querySelector('#endereco').value
            let bairro = document.querySelector('#bairro').value
            let municipio = document.querySelector('#municipio').value
            let uf = document.querySelector('#uf').value
            let email = document.querySelector('#email').value
            let fone = document.querySelector('#fone').value
            let contato = document.querySelector('#contato').value
            let cpf = document.querySelector('#cpf').value
            let inscricao = document.querySelector('#inscricao').value
            let cond_pagamento = document.querySelector('#cond_pagamento').value
            let transportadora = document.querySelector('#transportadora').value

            if (vendedor == "") {
                document.getElementById('erro-vendedor').innerHTML = "Preencha o campo vendedor !";
                document.getElementById('vendedor').focus();
                return false;

            } else {
                document.getElementById('erro-vendedor').innerHTML = "";
            }

            if (cod_cliente == "") {
                document.getElementById('erro-cod_cliente').innerHTML = "Preencha o campo código do cliente !";
                document.getElementById('cod_cliente').focus();
                return false;
            } else {
                document.getElementById('erro-cod_cliente').innerHTML = "";
            }

            if (loja_numero == "") {
                document.getElementById('erro-loja_numero').innerHTML = "Preencha o campo número da loja !";
                document.getElementById('loja_numero').focus();
                return false;
            } else {
                document.getElementById('erro-loja_numero').innerHTML = "";
            }

            if (data == "") {
                document.getElementById('erro-data').innerHTML = "Preencha o campo data !";
                document.getElementById('data').focus();
                return false;
            } else {
                document.getElementById('erro-data').innerHTML = "";
            }

            if (razao_social == "") {
                document.getElementById('erro-razao_social').innerHTML = "Preencha o campo Razão social!";
                document.getElementById('razao_social').focus();
                return false;
            } else {
                document.getElementById('erro-razao_social').innerHTML = "";
            }

            if (cep == "") {
                document.getElementById('erro-cep').innerHTML = "Preencha o campo CEP !";
                document.getElementById('cep').focus();
                return false;
            } else {
                document.getElementById('erro-cep').innerHTML = "";
            }

            if (endereco == "") {
                document.getElementById('erro-endereco').innerHTML = "Preencha o campo Endereço !";
                document.getElementById('endereco').focus();
                return false;
            } else {
                document.getElementById('erro-endereco').innerHTML = "";
            }

            if (bairro == "") {
                document.getElementById('erro-bairro').innerHTML = "Preencha o campo bairro !";
                document.getElementById('bairro').focus();
                return false;
            } else {
                document.getElementById('erro-bairro').innerHTML = "";
            }

            if (municipio == "") {
                document.getElementById('erro-municipio').innerHTML = "Preencha o campo municipio !";
                document.getElementById('municipio').focus();
                return false;
            } else {
                document.getElementById('erro-municipio').innerHTML = "";
            }

            if (uf == "") {
                document.getElementById('erro-uf').innerHTML = "Preencha o campo UF !";
                document.getElementById('uf').focus();
                return false;
            } else {
                document.getElementById('erro-uf').innerHTML = "";
            }

            if (email == "") {
                document.getElementById('erro-email').innerHTML = "Preencha o campo E-mail !";
                document.getElementById('email').focus();
                return false;
            } else {
                document.getElementById('erro-email').innerHTML = "";
            }

            if (fone == "") {
                document.getElementById('erro-fone').innerHTML = "Preencha o campo Telefone !";
                document.getElementById('fone').focus();
                return false;
            } else {
                document.getElementById('erro-fone').innerHTML = "";
            }

            if (contato == "") {
                document.getElementById('erro-contato').innerHTML = "Preencha o campo contato !";
                document.getElementById('contato').focus();
                return false;
            } else {
                document.getElementById('erro-contato').innerHTML = "";
            }

            if (cpf == "") {
                document.getElementById('erro-cpf').innerHTML = "Preencha o campo CPF !";
                document.getElementById('cpf').focus();
                return false;
            } else {
                document.getElementById('erro-cpf').innerHTML = "";
            }

            if (inscricao == "") {
                document.getElementById('erro-inscricao').innerHTML = "Preencha o campo inscrição estadual !";
                document.getElementById('inscricao').focus();
                return false;
            } else {
                document.getElementById('erro-inscricao').innerHTML = "";
            }

            if (cond_pagamento == "") {
                document.getElementById('erro-cond_pagamento').innerHTML = "Preencha o campo condição de pagamento !";
                document.getElementById('cond_pagamento').focus();
                return false;
            } else {
                document.getElementById('erro-cond_pagamento').innerHTML = "";
            }

            if (transportadora == "") {
                document.getElementById('erro-transportadora').innerHTML = "Preencha o campo transportadora !";
                document.getElementById('transportadora').focus();
                return false;
            } else {
                document.getElementById('erro-transportadora').innerHTML = "";
            }

            //Item
            let item = document.querySelectorAll('.item')
            let produto = document.querySelectorAll('.produto')
            let descricao = document.querySelectorAll('.descricao')
            let quantidade = document.querySelectorAll('.quantidade')
            let gbu = document.querySelectorAll('.gbu')
            let valor_unit = document.querySelectorAll('.valor_unit')
            let desc1 = document.querySelectorAll('.desc1')
            let valor_unit1 = document.querySelectorAll('.valor_unit1')
            let desc2 = document.querySelectorAll('.desc2')
            let valor_unit2 = document.querySelectorAll('.valor_unit2')
            let desc_final = document.querySelectorAll('.desc_final')
            let valor_unit3 = document.querySelectorAll('.valor_unit3')
            let total = document.querySelectorAll('.total')

            var itens = []
            for (let i = 0; i < produto.length; i++) {
                var items = {
                    "item": (item[i].value == "", 1, item[i].value),
                    "produto": produto[i].value,
                    "descricao": descricao[i].value,
                    "quantidade": quantidade[i].value,
                    "gbu": gbu[i].value,
                    "valor_unit": valor_unit[i].value,
                    "desc1": desc1[i].value,
                    "valor_unit1": valor_unit1[i].value,
                    "desc2": desc2[i].value,
                    "valor_unit2": valor_unit2[i].value,
                    "desc_final": desc_final[i].value,
                    "valor_unit3": valor_unit3[i].value,
                    "total": total[i].value,
                }

                console.log(itens)
                itens.push(items)

                if (items.item == "") {
                    document.getElementById('erro-item').innerHTML = "Preencha o campo item !";
                    document.getElementById('erro-item').style.color = 'red';
                    document.getElementById('item').focus();
                    return false;
                } else {
                    document.getElementById('erro-item').innerHTML = "Item";
                    document.getElementById('erro-item').style.color = 'black';
                }

                if (items.produto == "") {
                    document.getElementById('erro-produto').innerHTML = "Preencha o campo produto!";
                    document.getElementById('erro-produto').style.color = 'red';
                    document.getElementById('produto').focus();
                    return false;
                } else {
                    document.getElementById('erro-produto').innerHTML = "Produto";
                    document.getElementById('erro-produto').style.color = 'black';
                }

                if (items.gbu == "") {
                    document.getElementById('erro-gbu').innerHTML = "Preencha o campo gbu!";
                    document.getElementById('erro-gbu').style.color = 'red';
                    document.getElementById('gbu').focus();
                    return false;
                } else {
                    document.getElementById('erro-gbu').innerHTML = "GBU";
                    document.getElementById('erro-gbu').style.color = 'black';
                }

                if (items.valor_unit == "") {
                    document.getElementById('erro-valor_unit').innerHTML = "Preencha o campo valor_unit!";
                    document.getElementById('erro-valor_unit').style.color = 'red';
                    document.getElementById('valor_unit').focus();
                    return false;
                } else {
                    document.getElementById('erro-valor_unit').innerHTML = "Valor_Unit";
                    document.getElementById('erro-valor_unit').style.color = 'black';
                }

                if (items.valor_unit1 == "") {
                    document.getElementById('erro-valor_unit1').innerHTML = "Preencha o campo valor_unit1!";
                    document.getElementById('erro-valor_unit1').style.color = 'red';
                    document.getElementById('valor_unit1').focus();
                    return false;
                } else {
                    document.getElementById('erro-valor_unit1').innerHTML = "Valor_unit1";
                    document.getElementById('erro-valor_unit1').style.color = 'black';
                }

                if (items.valor_unit2 == "") {
                    document.getElementById('erro-valor_unit2').innerHTML = "Preencha o campo valor_unit2!";
                    document.getElementById('erro-valor_unit2').style.color = 'red';
                    document.getElementById('valor_unit2').focus();
                    return false;
                } else {
                    document.getElementById('erro-valor_unit2').innerHTML = "Valor_unit2";
                    document.getElementById('erro-valor_unit2').style.color = 'black';
                }

                if (items.valor_unit3 == "") {
                    document.getElementById('erro-valor_unit3').innerHTML = "Preencha o campo valor_unit3!";
                    document.getElementById('erro-valor_unit3').style.color = 'red';
                    document.getElementById('valor_unit3').focus();
                    return false;
                } else {
                    document.getElementById('erro-valor_unit3').innerHTML = "Valor_unit3";
                    document.getElementById('erro-valor_unit3').style.color = 'black';
                }

                if (items.total == "") {
                    document.getElementById('erro-total').innerHTML = "Preencha o campo total!";
                    document.getElementById('erro-total').style.color = 'red';
                    document.getElementById('total').focus();
                    return false;
                } else {
                    document.getElementById('erro-total').innerHTML = "total";
                    document.getElementById('erro-total').style.color = 'black';
                }

            }

            const response = await fetch('/pedido/registrar', {
                method: 'POST',
                headers: {
                    "Content-Type": "application/json",
                    'Accept': 'application/json'
                },
                body: JSON.stringify({
                    idPedido, vendedor, cod_cliente, loja_numero, data, razao_social,
                    cep, endereco, bairro, municipio, uf, email, fone, contato, cpf, inscricao, cond_pagamento, transportadora,
                    itens
                })
            })
                .then((response) => response.json())
                .then((data) => {
                    console.log("esse é a data", data)

                    if (data.message == "Produto não encontrado") {
                        swal("Error !", "Esse produto não foi encontrado: " + data.itemP, "error");
                    }

                    if (data.message == "Id não encontrado") {
                        swal("Error !", "Id não encontrado!", "error");
                    }

                    if (data.message == "Registro realizado com sucesso") {
                        swal("Sucesso !", "Registro realizado com sucesso", "success")
                    }

                    if (data.id_pedido) {
                        document.getElementById('idPedido').value = data.id_pedido
                    }
                })
        })


    } catch (err) {
        console.log(`Erro: ${err}`)
    }
    //API VIACEP 

    const limparFormulario = (endereco) => {
        document.querySelector('#bairro').value = '';
        document.querySelector('#municipio').value = '';
        document.querySelector('#uf').value = '';
        document.querySelector('#endereco').value = '';
    }

    const preencherFormulario = (endereco) => {
        document.querySelector('#bairro').value = endereco.bairro;
        document.querySelector('#municipio').value = endereco.localidade;
        document.querySelector('#uf').value = endereco.uf;
        document.querySelector('#endereco').value = endereco.logradouro;
    }

    const cepValido = (cep) => cep.length == 8;

    const pesquisarCep = async () => {
        limparFormulario();
        const cep = document.querySelector('#cep').value;
        const url = `https://viacep.com.br/ws/${cep}/json/`;

        if (cepValido(cep)) {
            const dados = await fetch(url);
            const endereco = await dados.json();

            if (endereco.hasOwnProperty('erro')) {
                document.querySelector('#endereco').disabled = true;
                document.querySelector('#bairro').disabled = true;
                document.querySelector('#municipio').disabled = true;
                document.querySelector('#uf').disabled = true;

            } else {
                document.querySelector('#endereco').disabled = false;
                document.querySelector('#bairro').disabled = false;
                document.querySelector('#municipio').disabled = false;
                document.querySelector('#uf').disabled = false;
                preencherFormulario(endereco);
            }

        } else {
            document.querySelector('#endereco').disabled = true;
            document.querySelector('#bairro').disabled = true;
            document.querySelector('#municipio').disabled = true;
            document.querySelector('#uf').disabled = true;
        }
    }

    document.querySelector('#cep')
        .addEventListener('focusout', pesquisarCep);

    window.addEventListener('load', function () {
        document.querySelectorAll('input').forEach((input) => {
            input.addEventListener('onchange', valor1(event))
        })
    });

</script>